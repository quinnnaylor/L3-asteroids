<!doctype html>

<head>
  <title>Asteroids</title>
  <script src="Player.js"></script>
  <script src="Asteroids.js"></script>
  <script src="Bullet.js"></script>
  <link rel="stylesheet" href="styles.css">
</head>

<body>
  <canvas id="gameCanvas" width="800" height="800"></canvas>

  <script>
    var canvas, canvasContext;

    window.onload = function () {
      canvas = document.getElementById('gameCanvas');
      canvasContext = canvas.getContext('2d');

      document.addEventListener('keydown', keyPressed);
      document.addEventListener('keyup', keyReleased);

      canvas.addEventListener('mousedown', function (evt) {
        var mousePos = mouseAction(evt);
        // var mouseClicked = MouseEvent(evt);
        mouseX = mousePos.x;
        mouseY = mousePos.y;
      });


      setInterval(mainloop, 1000 / 50);
    }

    // key codes
    const UP_KEY = 87;
    const DOWN_KEY = 83;
    const LEFT_KEY = 65;
    const RIGHT_KEY = 68;
    const SPACE_key = 32
    var upPressed = false;
    var downPressed = false;
    var leftPressed = false;
    var rightPressed = false;
    var spacePresed = false;

    var difficulty = '';
    var rate = 0.00001;
    var pass = false;
    while (pass == false) {
      difficulty = prompt('how hard do you want the game?', 'hard or easy?')

      if (difficulty.toLowerCase() == 'easy' || difficulty.toLowerCase() == 'hard') {
        pass = true;
      }
    }

    if (difficulty == 'easy') {
      rate = 0.4;
    } else {
      rate = 0.8;
    } //end of game dificulty code

    var pXpos = 390;
    var pYpos = 390;
    var pXspeed = 2;
    var pYspeed = 2;
    const P_SIZE = 20;

    var player = new Player(pXpos, pYpos, P_SIZE, P_SIZE, 'red', pXspeed, pYspeed, rate);

    var setUp = true;

    
    function mainloop() {
      // findSpawnPoint();
      // player.ratefunc();
      
      if (setUp) {
        for (var i = 0; i < 10; i++) {
          createEnemy();
        }
        // for (var i = 0; i < 10; i++) {
          //   createBullet();
          // }
          setUp = false;
        }
        colorRect(0, 0, canvas.width, canvas.height, 'black'); // bg
        
        
        
        player.drawRect() // player
        player.playerMove();
        player.playerSides();
        
        // Bullet.bulletSpeed();
        
        if (enemies.length > 0) {
          enemies.forEach(function (enemy, i, array) {
            enemy.drawRect();
            // enemy.spawnFunc();
            enemy.enemyMove();
            
            if (enemy.PlayerDeath()) {
              enemy.respawn();
            }
            
            if (enemy.outOfBounds()) {
              enemy.respawn();
            }
            
          }); // end foreach
        } // end if 
        if (bullets.length > 0) {
          bullets.forEach(function (bullet, i, array){
            bullet.drawRect();
            bullet.bulletMove();
          })
        }
      }
      
      var mouseX, mouseY;
      
      var fire = false;
      
      function mouseAction(evt) {
        var rect = canvas.getBoundingClientRect();
        var root = document.documentElement;
        mouseX = evt.clientX - rect.left - root.scrollLeft;
        mouseY = evt.clientY - rect.top - root.scrollTop;
        distanceToMouse();
        createBullet();
        return {
          x: mouseX,
        y: mouseY
      }
    }
    
    var bullets = [];
    
    var bulletXspeed = 0;
    var bulletYspeed = 10;


    function createBullet() {
      console.log('pew')
      
      // var bullet = new Bullet(bXpos, bYpos, bSize, bSize, 'white', bSpeed, bSpeed);
      const B_SIZE = 10;
      var bYpos = player.y + player.h / 2 - B_SIZE / 2;
      var bXpos = player.x + player.w / 2 - B_SIZE / 2; 
      
      // bulletXspeed = 0;
      
      // var bulletYspeed = 10;
      var bullet = new Bullet(bXpos, bYpos, B_SIZE, B_SIZE, 'blue', bulletXspeed, bulletYspeed);
      // var bSpeed = 10;
      bullets.push(bullet);
    }
    
    // var DistanceTM_YT = 0;
    // var DistanceTM_YB = 0;  
    // var DistanceTM_XL = 0;
    // var DistanceTM_XR = 0;

    var mouseXdisPlayerX = 0;
    var mouseYdisPlayerY = 0;
    // var DistanceTM_YB = 0;  
    // var DistanceTM_XL = 0;
    // var DistanceTM_XR = 0;

    function distanceToMouse() {

      // DistanceTM_XL = player.x - mouseX;
      // DistanceTM_XR = player.x + mouseX;

      // DistanceTM_YT = player.y - mouseY;
      // DistanceTM_YB = player.y + mouseY;

      mouseXdisPlayerX = mouseX - player.x;
      mouseYdisPlayerY = mouseY - player.y;
      
      if(mouseXdisPlayerX < 0 && mouseYdisPlayerY < 0){
        console.log('top left');

        bulletXspeed = -5;
        bulletYspeed = -5;
      } 
      
      else if(mouseXdisPlayerX < 0 && mouseYdisPlayerY > 0){
        console.log('bottom left');
       
        bulletXspeed = -5;
        bulletYspeed = 5;
      }
      
      else if(mouseXdisPlayerX > 0 && mouseYdisPlayerY < 0){
        console.log('top right');

        bulletXspeed = 5;
        bulletYspeed = -5;
      } 
      
      else if(mouseXdisPlayerX > 0 && mouseYdisPlayerY > 0){
        console.log('bottom right');
        
        bulletXspeed = 5;
        bulletYspeed = 5;
      }
      
    }
    
    
    // function bulletSpeed() {
      //   if (){
        
        //   }
        //   else if (){
        
    //   }
    //   else if (){
        
    //   }
    //    (){
        
    //   }
    // }

    var spawnPoints = ["up", "down", "left", "right"]

    var enemies = [];

    function createEnemy() {
      // enemy vars
      var eSize = Math.floor(Math.random() * (40 - 5) + 40);
      var eYpos = eSize;
      // var eYpos =  Math.floor(Math.random() * (canvas.height - eSize));
      var eXpos = Math.floor(Math.random() * (canvas.width - eSize));
      var eXspeed = Math.floor(Math.random() * (4 - 8) + 8);
      var eYspeed = Math.floor(Math.random() * (4 - 8) + 8);

      // create enemy class with vars
      var enemy = new Enemy(eXpos, eYpos, eSize, eSize, 'purple', eXspeed, eYspeed);
      // add enemy to enemies array
      enemies.push(enemy);

    } // end func

    function keyPressed(evt) {
      if (evt.keyCode == UP_KEY) {
        upPressed = true;
      }
      if (evt.keyCode == DOWN_KEY) {
        downPressed = true;
      }
      if (evt.keyCode == LEFT_KEY) {
        leftPressed = true;
      }
      if (evt.keyCode == RIGHT_KEY) {
        rightPressed = true;
      }
    }

    function keyReleased(evt) {
      if (evt.keyCode == UP_KEY) {
        upPressed = false;
      }
      if (evt.keyCode == DOWN_KEY) {
        downPressed = false;
      }
      if (evt.keyCode == LEFT_KEY) {
        leftPressed = false;
      }
      if (evt.keyCode == RIGHT_KEY) {
        rightPressed = false;
      }
    }

    function colorRect(x, y, w, h, c) {
      canvasContext.fillStyle = c;
      canvasContext.fillRect(x, y, w, h);
    }
  </script>
</body>